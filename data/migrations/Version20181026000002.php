<?php

use Symfony\Component\Console\Output\OutputInterface;
use Zco\Bundle\Doctrine1Bundle\Migrations\AbstractMigration;

/**
 * Delete obsolete credentials.
 *
 * @author vincent1870 <vincent@zcorrecteurs.fr>
 */
class Version20181026000002 extends AbstractMigration
{
    public function up(OutputInterface $output)
    {
        $credentials = [
            'quiz_voir',
            'quiz_editer',
            'quiz_editer_siens',
            'quiz_supprimer',
            'quiz_supprimer_siens',
            'quiz_ajouter_questions',
            'quiz_ajouter_questions_siens',
            'quiz_editer_ses_questions',
            'quiz_editer_questions',
            'quiz_supprimer_questions',
            'quiz_supprimer_ses_questions',
            'membres_voir_avertos',
            'membres_avertir',
            'dictees_voir',
            'dictees_proposer',
            'blog_ajouter',
            'droits_recharger',
            'voir_historique_groupes',
            'mp_voir',
            'mp_envoyer_auto',
            'auteurs_ajouter',
            'blog_voir',
            'blog_commenter',
            'blog_supprimer_commentaires',
            'cats_ajouter',
            'cats_supprimer',
            'cats_ordonner',
            'citations_ajouter',
            'citations_supprimer',
            'citations_autoriser',
            'gerer_mess_autos',
            'recrutements_ajouter',
            'recrutements_supprimer',
            'recrutements_postuler',
            'recrutements_editer_shoutbox',
            'recrutements_supprimer_shoutbox',
            'voir_graphiques',
            'livredor',
            'livredor_ecrire',
            'livredor_supprimer',
            'livredor_epargne_anti_up',
            'livredor_editer',
            'zcorriger',
            'voir_tutos_attente',
            'voir_tutos_correction',
            'voir_tutos_corriges',
            'envoyer_tutos',
            'zcorrection_voir_tutos_refuses',
            'zcorrection_editer_tutos',
            'zcorrection_priorite',
            'zcorrection_retirer',
            'zcorrection_voir_soumissions_membre',
            'blog_voir_billets_membre',
            'blog_voir_tous_les_commentaires',
            'quiz_ses_stats',
            'voir_liste_membres',
            'voir_membres_en_ligne',
            'voir_profil',
            'membres_regenerer_password_groupe',
            'ips_voir_bannies',
            'stats_prive',
            'stats_forum',
            'voir_rapport_zcorr',
            'stats_zcorrecteur',
            'stats_zcorrecteurs',
            'recrutements_voir',
            'gerer_config',
            'publicite_raz_affichages',
            'gerer_caches',
            'sondages_ajouter',
            'sondages_editer',
            'sondages_supprimer',
            'sondages_voir',
            'sondages_voter',
            'sondages_voir_resultats',
            'publicite_editer_etat',
            'poster_sondage',
            'fermer_sondage',
            'poster_reponse_auto',
            'voir_votants',
            'ajouter_sondages',
            'editer_sondages',
            'supprimer_sondages',
            'sondages_supprimer_siens',
            'sondages_editer_siens',
            'quiz_stats',
            'sondages_voir_caches',
            'blog_supprimer_ses_commentaires',
            'forum_voir_activite',
            'citations',
            'membres_voir_actions_team',
            'tracker_voir',
            'tracker_ajouter',
            'tracker_voir_prives',
            'roadmap_voir',
            'tracker_assigner',
            'tracker_supprimer',
            'tracker_etre_assigne',
            'tracker_repondre',
            'tracker_changer_resolution',
            'tracker_changer_resolution_siens',
            'tracker_changer_priorite',
            'tracker_changer_priorite_siens',
            'tracker_editer_siens',
            'tracker_editer',
            'roadmap_gerer',
            'tracker_changer_resolution_assignes',
            'tracker_supprimer_reponses',
            'publicite_editer_ciblage_siens',
            'depot_voir',
            'tracker_voir_assigne',
            'tracker_marquer_doublon',
            'publicite_editer_createur',
            'publicite_editer_createur_siens',
            'roadmap_voir_prives',
            'publicite_editer_ciblage',
            'tracker_lier_roadmap',
            'tracker_gerer_branches',
            'tracker_lier_revisions',
            'sondages_voir_votants',
            'publicite_editer',
            'publicite_voir',
            'publicite_supprimer',
            'publicite_editer_siens',
            'publicite_changer_etat',
            'publicite_changer_etat_siens',
            'publicite_editer_etat_siens',
            'publicite_proposer',
            'dons_ajouter',
            'dons_editer',
            'twitter_voir',
            'twitter_tweeter',
            'twitter_comptes',
            'dons_supprimer',
            'publicite_cacher_adsense',
            'quiz_stats_generales_quiz',
            'zcorrection_supprimer',
            'aide_voir',
            'aide_ajouter',
            'aide_modifier',
            'aide_supprimer',
            'htaccess_doc',
            'htaccess_munin',
            'htaccess_dev',
            'recherche',
            'depot_commit',
            'stats_developpement',
            'supprimer_tous_messages',
            'publicite_raz_clics',
            'tracker_editer_reponses',
            'tracker_editer_reponses_siennes',
            'stats_blog_flux',
            'stats_voir',
            'tags_ajouter',
            'tags_editer',
            'tracker_forcer_suivi',
            'membres_voir_cle_pgp',
            'recherche_logs',
            'membres_inscrire',
            'dictees_supprimer',
            'publicite_js',
            'publicite_activer',
            'publicite_activer_siens',
            'modifier_sexe',
            'twitter_procuration',
            'quiz_supprimer_questions',
            'auteurs_modifier',
            'annonces_ajouter',
            'annonces_modifier',
            'annonces_supprimer',
            'annonces_publier',
            'evolution_voir_retours',
            'options_ajouter_cle_pgp',
            'voir_adresse',
            'modifier_adresse',
            'stats_inscription',
            'stats_geolocalisation',
            'voir_stats_ages',
            'quiz_stats_generales',
            'forum_stats_generales',
            'code',
        ];

        $stmt = $this->dbh->prepare('SELECT droit_id FROM zcov2_droits WHERE droit_nom IN("' . implode('", "', $credentials) . '")');
        $stmt->execute();
        $rows = $stmt->fetchAll();
        $ids = [];
        foreach ($rows as $i => $row) {
            $ids[] = $row['droit_id'];
        }

        $this->addSql('DELETE FROM zcov2_groupes_droits WHERE gd_id_droit IN(' . implode(', ', $ids) . ')');
        $this->addSql('DELETE FROM zcov2_droits WHERE droit_id IN(' . implode(', ', $ids) . ')');
    }

    public function down(OutputInterface $output)
    {
        $this->throwIrreversibleMigrationException();
    }
}