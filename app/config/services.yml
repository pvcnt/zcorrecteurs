services:
  # default configuration for services in *this* file
  _defaults:
    autowire: true
    autoconfigure: true
    public: true

  #Zco\:
  #  resource: '../src/Zco'
  #  exclude: '../src/Zco/**/{Entity,Migrations,Tests}'

  # controllers are imported separately to make sure services can be injected
  # as action arguments even if you don't extend any base controller class
  #Zco\Controller\:
  #  resource: '../src/Zco/Controller'
  #  tags: ['controller.service_arguments']

  Zco\Bundle\Doctrine1Bundle\Command\:
    resource: '../../src/Zco/Bundle/Doctrine1Bundle/Command/*'
    tags: ['console.command']

  Zco\Bundle\UserBundle\Command\:
    resource: '../../src/Zco/Bundle/UserBundle/Command/*'
    tags: ['console.command']

  Zco\Bundle\ContentBundle\Admin\Admin:
    public: true
    arguments: ['@cache', !tagged zco.admin_task]

  Zco\Bundle\CoreBundle\EventListener\EventListener:
    calls:
    - [setContainer, ["@service_container"]]
    tags:
    - { name: kernel.event_subscriber }

  zco.repository.quotes:
    class: Zco\Bundle\ContentBundle\Domain\QuoteRepository
    public: true
    arguments: ['@zco_doctrine1.connection']

  zco_core.registry:
    class:     Zco\Bundle\CoreBundle\Registry
    public:    true
    arguments: ['@cache']

  Zco\Bundle\CoreBundle\Form\Type\ZformType:
    tags:
    - { name: form.type, alias: zform }

  imagine:
    class: Imagine\Gd\Imagine
    public: true

  cache:
    class: Doctrine\Common\Cache\ApcuCache
    public: true

  swiftmailer.transport.sendgrid:
    class: Zco\Bundle\CoreBundle\SwiftMailer\SendGridTransport
    arguments:
    - "@swiftmailer.mailer.default.transport.eventdispatcher"
    - "%env(SENDGRID_APIKEY)%"
    - []
    calls:
    - method: setLogger
      arguments:
      - '@?logger'

  zco_core.templating.helper.humanize:
    class: Zco\Bundle\CoreBundle\Templating\Helper\HumanizeHelper
    tags:
    - { name: templating.helper, alias: humanize }

  zco_core.templating.helper.messages:
    class: Zco\Bundle\CoreBundle\Templating\Helper\MessagesHelper
    arguments: ["@zco_parser.parser", "@zco_core.resource_manager", '@zco.uploads_filesystem']
    tags:
    - { name: templating.helper, alias: messages }

  zco.gaufrette_adapter:
    class: Gaufrette\Adapter\Local
    arguments: ['%kernel.root_dir%/../public/uploads', true]

  zco.gaufrette_filesystem:
    class: Gaufrette\Filesystem
    arguments: ['@zco.gaufrette_adapter']

  zco.gaufrette_resolver:
    class: Gaufrette\Extras\Resolvable\Resolver\StaticUrlResolver
    arguments: ['/uploads']

  zco.uploads_filesystem:
    class: Gaufrette\Extras\Resolvable\ResolvableFilesystem
    public: true
    arguments: ['@zco.gaufrette_filesystem', '@zco.gaufrette_resolver']

  zco_file.uploader:
    class: Zco\Bundle\FileBundle\Util\FileUploader
    arguments: ["@zco.uploads_filesystem", "@imagine"]

  zco_parser.parser:
    class: Zco\Bundle\CoreBundle\Parser\zCodeParser
    arguments: [!tagged zco.parser_feature]

  Zco\Bundle\CoreBundle\Parser\CoreFeature:
    tags:
    - { name: zco.parser_feature }

  Zco\Bundle\CoreBundle\Parser\SmiliesFeature:
    tags:
    - { name: zco.parser_feature }

  Zco\Bundle\CoreBundle\Parser\FilesFeature:
    arguments: ["@zco.uploads_filesystem", "@imagine"]
    tags:
    - { name: zco.parser_feature }

  zco_quiz.stats:
    class: Zco\Bundle\QuizBundle\Service\StatsService
    public: true

  zco_quiz.manager.quiz:
    class: Zco\Bundle\QuizBundle\Entity\QuizManager
    public: true
    arguments: ['@zco_doctrine1.connection', '@cache']

  zco_quiz.manager.score:
    class: Zco\Bundle\QuizBundle\Entity\QuizScoreManager
    public: true
    arguments: ['@zco_doctrine1.connection']

  zco_search.search_engine:
    class: Zco\Bundle\ContentBundle\Search\Sphinx\SphinxSearchEngine
    arguments: ['%sphinx_host%', '%sphinx_port%']

  zco_search.search_service:
    class: Zco\Bundle\ContentBundle\Search\SearchService
    arguments: ['@zco_search.search_engine']

  Zco\Bundle\UserBundle\Validator\Constraints\UsernameValidator:
    arguments: ["@zco_user.user"]
    tags:
    - { name: validator.constraint_validator, alias: zco_user_username }

  Zco\Bundle\UserBundle\Validator\Constraints\PasswordValidator:
    arguments: ["@zco_user.user"]
    tags:
    - { name: validator.constraint_validator, alias: zco_user_password }

  Zco\Bundle\UserBundle\Validator\Constraints\EmailValidator:
    arguments: ["@zco_user.user"]
    tags:
    - { name: validator.constraint_validator, alias: zco_user_email }

  Zco\Bundle\UserBundle\Validator\Constraints\UserPasswordValidator:
    arguments: ["@zco_user.user"]
    tags:
    - { name: validator.constraint_validator, alias: zco_user_userpassword }

  Zco\Bundle\UserBundle\EventListener\EventListener:
    calls:
    - [setContainer, ["@service_container"]]
    tags:
    - { name: kernel.event_subscriber }

  Zco\Bundle\UserBundle\EventListener\LoginListener:
    calls:
    - [setContainer, ["@service_container"]]
    tags:
    - { name: kernel.event_subscriber }

  zco_user.user:
    class:     Zco\Bundle\UserBundle\User\UserSession
    public:    true
    arguments: ["@event_dispatcher"]

  Zco\Bundle\UserBundle\Service\IpAddressLocator:
    public: true
    arguments: ['@zco_doctrine1.connection']

  templating.globals:
    class: Zco\Bundle\CoreBundle\Templating\GlobalVariables
    arguments: ['@service_container']

parameters:
  analytics_account: ''

  sphinx_host: localhost
  sphinx_port: 5000